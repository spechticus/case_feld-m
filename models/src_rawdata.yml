---
version: 2
sources:
  - name: raw_layer
    description: The raw data obtained from the assignment to be ingested
    tables:
      - name: categories
        config:
          tags: [raw_layer]
        columns:
          - name: category_id
            data_type: int
            tests: [not_null, unique]
          - name: category_name
            data_type: string
            tests: [not_null]

      - name: customers
        config:
          tags: [raw_layer]
        columns:
          - name: customer_id
            data_type: int
            tests: [not_null, unique]
          - name: company_name
            data_type: string
            tests: [not_null, character_parsed_correctly]
          - name: contact_name
            data_type: string
            tests: [not_null, character_parsed_correctly]

      - name: employees
        config:
          tags: [raw_layer]
        columns:
          - name: employee_id
            data_type: int
            tests: [not_null, unique]
          - name: first_name
            data_type: string
            tests: [character_parsed_correctly]
          - name: last_name
            data_type: string
            tests: [character_parsed_correctly]
          - name: birth_date
            data_type: date
            tests:
              - dbt_utils.accepted_range:
                  # The hire_dates are all in the 1990s, so we will assume
                  # the year 2000 as a reference point for reasonable age of the employees
                  # All employees are assumed to be 18-80 years old in the year 2000
                  max_value: "'2000-01-01'::DATE - interval '18' year"
                  min_value: "'2000-01-01'::DATE - interval '80' year"
          - name: hire_date
            data_type: date
            tests:
              - dbt_utils.accepted_range:
                  # Since we above assumed that all employees are 18-80 years old in the year 2000:
                  # max_value: we will assume that all employees cannot thus be hired later than the year 2000
                  # min_value: when you were 80 years old in the year 2000, and you were hired at 18, you were hired 62 years before 2000.
                  max_value: "'2000-01-01'::DATE"
                  min_value: "'2000-01-01'::DATE - interval '62' year"
          - name: address
            data_type: string
            tests: [not_null, character_parsed_correctly]
          - name: city
            data_type: string
            tests: [not_null, character_parsed_correctly]
          - name: region
            data_type: string
            tests: [character_parsed_correctly]
          - name: postal_code
            data_type: string
            tests: [not_null]
          - name: country
            data_type: string
            tests: [not_null]

      - name: order_details
        config:
          tags: [raw_layer]
        columns:
          - name: order_id
            data_type: int
            tests:
              - not_null
              - relationships:
                  to: ref('orders')
                  field: order_id
          - name: product_id
            data_type: int
            tests:
              - not_null
              - relationships:
                  to: source('raw_layer', 'products')
                  field: product_id
          - name: unit_price
            data_type: numeric
            tests:
              - not_null
              - property_equal_to_reference:
                  id_column: product_id
                  reference_table: source('raw_layer', 'products')

          - name: quantity
            data_type: int
            tests: [not_null]
          - name: discount
            data_type: numeric
            tests: [not_null]

      - name: orders
        config:
          tags: [raw_layer]

      - name: products
        config:
          tags: [raw_layer]

      - name: shippers
        config:
          tags: [raw_layer]
